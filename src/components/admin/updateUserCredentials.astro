---
export const prerender = false
---

<section>
  <form>
    <label for="username">
      <span class="usernameName">Nombre de usuario anterior:</span>
      <input type="text" name="username" placeholder="Nombre de usuario" required />
    </label>
    <label for="newUserName">
      <span class="usernameName">Nuevo nombre de usuario:</span>
      <input type="text" name="newUserName" placeholder="Nuevo Nombre de usuario" required />
    </label>
    <label for="password">
      <span class="userPassword">Nueva contraseña:</span>
      <input class="password" type="password" name="password" placeholder="Nueva contraseña" required />
    </label>
    <label for="confirmPassword">
      <span class="userPassword">Confirmar contraseña:</span>
      <input class="password" type="password" name="confirmPassword" placeholder="Confirmar contraseña" required />
      <button type="submit">Actualizar Credenciales</button>
    </label>

    <script>
      const form = document.querySelector('form')
      form.addEventListener('submit', async e => {
        e.preventDefault()
        const data = Object.fromEntries(new FormData(e.target as HTMLFormElement))
        if (data.password !== data.confirmPassword) {
          form.appendChild(document.createElement('p')).textContent = 'Las contraseñas no coinciden'
          form.lastChild.style.color = 'red'
          form.lastChild.style.fontWeight = 'bold'
          form.lastChild.style.textAlign = 'center'
          form.lastChild.style.marginTop = '10px'
          setTimeout(() => {
            form.lastChild.remove()
          }, 5000)
          return
        } else {
          try {
            const response = await fetch('http://localhost:4000/update/', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              credentials: 'include',
              body: JSON.stringify(data),
            })
            console.log('Enviando datos:', data)
            if (response.ok) {
              const res = await response.json()
              console.log(res)
            } else {
              throw new Error('Error al actualizar las credenciales')
            }
          } catch (err) {
            form.appendChild(document.createElement('p')).textContent = 'Error al actualizar las credenciales'
            form.lastChild.style.color = 'red'
            form.lastChild.style.fontWeight = 'bold'
            form.lastChild.style.textAlign = 'center'
            form.lastChild.style.marginTop = '10px'
            setTimeout(() => {
              form.lastChild.remove()
            }, 5000)
          }
        }
      })
    </script>
  </form>

  <style>
    section {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background-color: #f9f9f9;
      border-radius: 8px;
      margin: auto;
      width: 100%;
    }

    form {
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    label {
      margin-bottom: 15px;
    }

    input {
      padding: 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
  </style>
</section>
